version: "3.8"

services:
  memegen:
    build:
      context: .
      dockerfile: Containerfile.dev
    container_name: memegen-dev
    ports:
      - "8000:5000" # API server (host:container)
      - "5001:5001" # MkDocs site
    volumes:
      # Mount source code for hot reload
      - ./app:/opt/memegen/app
      - ./templates:/opt/memegen/templates
      - ./scripts:/opt/memegen/scripts
      - ./fonts:/opt/memegen/fonts
      - ./docs:/opt/memegen/docs
      - ./pyproject.toml:/opt/memegen/pyproject.toml
      - ./poetry.lock:/opt/memegen/poetry.lock
      # Mount poetry cache to speed up rebuilds
      - memegen-poetry-cache:/opt/memegen/.cache/pypoetry
    environment:
      - DEBUG=true
      - PYTHONUNBUFFERED=1
      - PYTHONASYNCIODEBUG=1
    command: poetry run honcho start --procfile Procfile.dev
    restart: unless-stopped
    stdin_open: true
    tty: true

volumes:
  memegen-poetry-cache:
